<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="images/favicon.png"/>
	  <link href="https://fonts.googleapis.com/css?family=Montserrat:200i,300,300i,400,400i,500,500i,600,600i,700,700i,800,800i,900,900i" rel="stylesheet"> 
    <title>Jasmine's Store Signup</title>
    <!--custom css, themevault.net-->
		<link href="css/timepiece/bootstrap.min.css" rel="stylesheet" type="text/css" />
		<link href="fonts/css/font-awesome.min.css" rel="stylesheet" type="text/css" />
		<link href="css/timepiece/style.css" rel="stylesheet" type="text/css" />
		<link href="css/timepiece/responsive.css" rel="stylesheet" type="text/css" />
		<!--js --->
		<script src="templatejs/jquery.min.js" type="text/javascript"></script>
		<script src="templatejs/bootstrap.min.js" type="text/javascript"></script>
		<script src="templatejs/custom.js" type="text/javascript"></script>
    <script>
      window.onload = function() {

        //Retrieve error from server, convert it to a proper array
        let params = (new URL(document.location)).searchParams;
        
        //Split params into quantities and errors
        let quantities = [];
        let errors = []
        let qtyStr = '';
        
        //Looked on google way too look to figure out how to do this
        //Separate each key, quantity, and error and separate it one by one
        params.forEach((value, key) => {
          if (key.startsWith('quantity') || key === 'purchase_submit') {
            if (key === 'purchase_submit') {
              qtyStr += `${key}=${value}&`;
            } else {
              quantities.push(`${key}=${value}`);
            }
          } else if (key.startsWith('error')) {
            errors.push(value);
          } else if (key === 'firstname' || key === 'lastname' || key === 'email') {
            document.getElementById("input-" + key).value = decodeURIComponent(value);
          }
        });

        console.log(quantities);
        console.log(errors);

        if (errors.length > 0) {
          for (let i in errors) {
            errorMsg = errors[i];
            document.getElementById('errorsbox').innerHTML += errorMsg + " ";
            document.getElementById('errorsbox').style.color = "red";
          }
        }
          //rebuild quantity string
          qtyStr += quantities.join("&");
          document.getElementById('input-qstr').value = qtyStr;
          //append to login href in case of user error
          document.getElementById("loginLink").href = "/login.html" + "?" + qtyStr; 
        }
  </script>
  </head>
  <body>
    <!--Code taken from themevault https://www.themevault.net/timecenter-watch-ecommerce-web-template#-->
    <!--Slightly modified for assignemnt 2 use, copied up to line 78-->
    <div id="content" class="col-sm-9">
      <div class="row">
        <div id="content" class="col-sm-12">
          <h3>
            <strong>I AM A NEW CUSTOMER</strong>
          </h3>
          <p>If you already have an account with us, please login at the <a href="login.html" id="loginLink" style="color: purple; font-weight: bold">login page</a>. </p>
          <br>
          <form action="/register" method="POST" class="form-horizontal">
            <fieldset id="account">
              <legend>Your Personal Details</legend>
              <div class="form-group required" style="display: none;">
                <label class="col-sm-2 control-label">Customer Group</label>
                <div class="col-sm-10">
                  <div class="radio">
                    <input type="radio" id="customer_group_id1" name="customer_group_id" value="1" checked="checked">
                    <label for="customer_group_id1"> Default</label>
                  </div>
                </div>
              </div>
              <div class="form-group required">
                <label class="col-sm-2 control-label" for="input-firstname">First Name</label>
                <div class="col-sm-10">
                  <input type="text" name="firstname" value="" placeholder="First Name" id="input-firstname" class="form-control">
                </div>
              </div>
              <div class="form-group required">
                <label class="col-sm-2 control-label" for="input-lastname">Last Name</label>
                <div class="col-sm-10">
                  <input type="text" name="lastname" value="" placeholder="Last Name" id="input-lastname" class="form-control">
                </div>
              </div>
              <div class="form-group required">
                <label class="col-sm-2 control-label" for="input-email">E-Mail</label>
                <div class="col-sm-10">
                  <input type="email" name="email" value="" placeholder="E-Mail" id="input-email" class="form-control">
                </div>
              </div>
            </fieldset>
            <fieldset>
              <legend>Your Password</legend>
              <div class="form-group required">
                <label class="col-sm-2 control-label" for="input-password">Password</label>
                <div class="col-sm-10">
                  <input type="password" name="password" value="" placeholder="Password" id="input-password" class="form-control">
                </div>
              </div>
              <div class="form-group required">
                <label class="col-sm-2 control-label" for="input-confirm">Password Confirm</label>
                <div class="col-sm-10">
                  <input type="password" name="repeat_password" value="" placeholder="Password Confirm" id="input-confirm" class="form-control">
                  <input id="input-qstr" type="hidden" name="hidden" value="">
                </div>
              </div>
            </fieldset>
            <div class="buttons">
              <div class="pull-right">I have read and agree to the <a class="agree">
                  <b>Privacy Policy</b>
                </a>
                <input type="checkbox" id="agree1" name="agree" value="1" style="vertical-align: text-bottom">
                <label for="agree1"></label> &nbsp; <input type="submit" value="Continue" class="btn btn-primary">
              </div>
            </div>
          </form>
          <div id="errorsbox"></div>
        </div>
      </div>
    </div>
  </body>
</html>